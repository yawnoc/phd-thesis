\chapter{Boundary tracing in curvilinear coordinates}
\label{ch:curvilinear}

The actual determination of the sought-after traced boundaries involves
recasting the flux boundary condition~(\ref{eq:flux-boundary-condition})
as an ODE (or system of ODEs) for the traced boundaries.
In practice, the appropriate coordinate system and parametrisation
will depend on the geometry of the specific problem at hand.
In preparation for the various coordinate systems
which will be used in this thesis,
I derive in this chapter the boundary tracing ODE
in an orthogonal curvilinear coordinate system,
along with the corresponding system of ODEs
under arc-length parametrisation.

\section{Orthogonal curvilinear coordinates in 2D}
\label{sec:curvilinear.orthogonal}

Let~$(\basisvec{x}, \basisvec{y})$ be the standard basis vectors
of the usual Cartesian coordinates~$(x, y)$.
The \emph{position vector} is
\begin{equation}
  \vec{r} = x \basisvec{x} + y \basisvec{y},
  \label{eq:position-vector-cartesian}
\end{equation}
and since $\basisvec{x}$ and~$\basisvec{y}$ are globally constant,
observe that
\begin{align}
  \basisvec{x} &= \pder{\vec{r}}{x},
    \label{eq:x-basis-vector} \\[\fraclinespace]
  \basisvec{y} &= \pder{\vec{r}}{y}.
    \label{eq:y-basis-vector}
\end{align}
Now consider the \emph{curvilinear coordinates}~$(u, v)$
given by the transformation
\begin{align}
  x &= x (u, v), \label{eq:curvilinear-x-transformation} \\
  y &= y (u, v). \label{eq:curvilinear-y-transformation}
\end{align}
A \emph{local basis}~$(\localvec{u}, \localvec{v})$
arises from the derivatives of position
in analogy to~(\ref{eq:x-basis-vector}) and~(\ref{eq:y-basis-vector}),
\begin{align}
  \localvec{u} &
    = \pder{\vec{r}}{u}
    = \pder{x}{u} \basisvec{x} + \pder{y}{u} \basisvec{y},
      \label{eq:u-local-basis-vector} \\[\fraclinespace]
  \localvec{v} &
    = \pder{\vec{r}}{v}
    = \pder{x}{v} \basisvec{x} + \pder{y}{v} \basisvec{y}.
      \label{eq:v-local-basis-vector}
\end{align}
It is assumed that the curvilinear coordinates~$(u, v)$ are \emph{orthogonal},
meaning the local basis vectors are orthogonal to each other:
\begin{equation}
  \localvec{u} \dotp \localvec{v} = 0.
  \label{eq:local-basis-orthogonal}
\end{equation}
The magnitudes of the local basis vectors may not be unity;
in fact, should either~$u$ or~$v$ not have dimensions of length,
the corresponding local basis vector will not even be dimensionless.
Therefore, one defines the \emph{scale factors}
(or \emph{\lame{} coefficients})
\begin{align}
  \scalefac{u} &= \norm{\localvec{u}}, \label{eq:u-scale-factor} \\
  \scalefac{v} &= \norm{\localvec{v}}, \label{eq:v-scale-factor}
\end{align}
and then normalises the local basis
to obtain the \emph{local orthonormal basis},
\begin{align}
  \basisvec{u} &= \frac{\localvec{u}}{\scalefac{u}},
      \label{eq:u-basis-vector} \\[\fraclinespace]
  \basisvec{v} &= \frac{\localvec{v}}{\scalefac{v}}.
      \label{eq:v-basis-vector}
\end{align}

\section{Vector calculus}
\label{sec:curvilinear.calculus}

\subsection{Differential displacement}
\label{sec:curvilinear.calculus.displacement}

Consider the $u$-contour and the $v$-contour through a point~$(u, v)$.
Independently incrementing~$u$ by~$\td u$ and~$v$ by~$\td v$
results in two new contours,
corresponding to each of the new coordinates.
Since the coordinate system is orthogonal,
the four contours (two old and two new)
shall mark out an infinitesimal rectangle,
aligned with the local orthonormal basis,
and, with sides of length~$\scalefac{u} \td u$ and~$\scalefac{v} \td v$.
Indeed the \emph{differential displacement vector} is
\begin{align*}
  \td \vec{r}
  &= \pder{\vec{r}}{u} \td u + \pder{\vec{r}}{v} \td v \\[\fraclinespace]
  &= \localvec{u} \td u + \localvec{v} \td v \\
  &= \scalefac{u} \td u \basisvec{u} + \scalefac{v} \td v \basisvec{v}.
    \yesnumber
    \label{eq:differential-displacement-vector}
\end{align*}
The area of the infinitesimal rectangle is
the \emph{differential area element}
\begin{equation}
  \td V = \scalefac{u} \scalefac{v} \td u \td v.
  \label{eq:differential-area-element}
\end{equation}

\subsection{Gradient}
\label{sec:curvilinear.calculus.gradient}

Consider a scalar field~$T$.
By the chain rule, the independent increments~$\td u$ and~$\td v$
effect the differential change
\begin{align*}
  \td T
  &= \pder{T}{u} \td u + \pder{T}{v} \td v \\
  &=
    \roundbr*{\frac{1}{\scalefac{u}} \pder{T}{u}}
    \roundbr[\big]{\scalefac{u} \td u}
      +
    \roundbr*{\frac{1}{\scalefac{v}} \pder{T}{v}}
    \roundbr[\big]{\scalefac{v} \td v}.
    \yesnumber
    \label{eq:scalar-differential-change}
\end{align*}
By the definition of gradient,
and using~(\ref{eq:differential-displacement-vector}),
\begin{align*}
  \td T
  &= \del T \dotp \td \vec{r} \\
  &=
    \del T
      \dotp
    \roundbr[\big]{
      \scalefac{u} \td u \basisvec{u}
        +
      \scalefac{v} \td v \basisvec{v}
    }.
    \yesnumber
    \label{eq:scalar-differential-change-gradient}
\end{align*}
Comparing~(\ref{eq:scalar-differential-change})
and~(\ref{eq:scalar-differential-change-gradient}),
it follows that the \emph{gradient} of~$T$ is given by
\begin{equation}
  \del T =
    \frac{1}{\scalefac{u}} \pder{T}{u} \basisvec{u}
      +
    \frac{1}{\scalefac{v}} \pder{T}{v} \basisvec{v}.
  \label{eq:gradient}
\end{equation}

\subsection{Divergence}
\label{sec:curvilinear.calculus.divergence}

Consider a vector field~$%
\vec{F} = \comp{F}{u} \basisvec{u} + \comp{F}{v} \basisvec{v}$,
and the infinitesimal rectangle
of Section~\ref{sec:curvilinear.calculus.displacement},
whose sides are of length~$\scalefac{u} \td u$ and~$\scalefac{v} \td v$.

To first order,
the net flux across the two edges normal to~$\basisvec{u}$
(which have length~$\scalefac{v} \td v$) is
\[
  \pder{}{u} \roundbr[\Big]{
    \comp{F}{u} \cdot \scalefac{v} \td v
  } \cdot \td u,
\]
and the net flux across the two edges normal to~$\basisvec{v}$
(which have length~$\scalefac{u} \td u$) is
\[
  \pder{}{v} \roundbr[\Big]{
    \comp{F}{v} \cdot \scalefac{u} \td u
  } \cdot \td v.
\]
Summing these results in the flux across the perimeter of the rectangle,
which, divided by its area,
the area element~(\ref{eq:differential-area-element}),
yields the \emph{divergence} of~$\vec{F}$,
\begin{equation}
  \del \dotp \vec{F} =
    \frac{1}{\scalefac{u} \scalefac{v}}
    \squarebr*{
      \pder{}{u} \roundbr[\Big]{\scalefac{v} \comp{F}{u}}
        +
      \pder{}{v} \roundbr[\Big]{\scalefac{u} \comp{F}{v}}
    }.
  \label{eq:divergence}
\end{equation}

\subsection{Boundary normal}
\label{sec:curvilinear.calculus.normal}

The \emph{tangent vector}~$\tangentvec$ to a curve
is given by the unit vector of
the differential displacement~(\ref{eq:differential-displacement-vector}),
i.e.,
\begin{equation}
  \tangentvec =
    \frac{
      \scalefac{u} \td u \basisvec{u}
        +
      \scalefac{v} \td v \basisvec{v}
    }{
      \td s
    },
  \label{eq:tangent-vector}
\end{equation}
where $\td s$~is the \emph{differential arc length}
\begin{equation}
  \td s = \norm{\td \vec{r}} =
  \sqrt{
    \roundbr[\big]{\scalefac{u} \td u}^2
      +
    \roundbr[\big]{\scalefac{v} \td v}^2
  }.
  \label{eq:differential-arc-length}
\end{equation}
The normal vector~$\normalvec$ to a curve
is perpendicular to the tangent~$\tangentvec$;
therefore
\begin{equation}
  \normalvec =
    \frac{
      \scalefac{v} \td v \basisvec{u}
        -
      \scalefac{u} \td u \basisvec{v}
    }{
      \td s
    },
  \label{eq:normal-vector}
\end{equation}
up to sign.
