\chapter{Curvilinear boundary tracing}
\label{ch:curvilinear}

The actual determination of the sought-after traced boundaries involves
recasting the flux boundary condition~(\ref{eq:flux-boundary-condition})
as a first-order ODE (or system of ODEs) for the traced boundaries.
In practice, the appropriate coordinate system and parametrisation
will depend on the geometry of the specific problem at hand.

Whilst Anderson~\etal~\cite{
  anderson-2007-boundary-tracing-i-theory,
  anderson-2007-boundary-tracing-ii-applications
}
did not restrict themselves to Cartesian coordinates in analytical work,
the boundary tracing ODE was separately derived
for each new coordinate system encountered;
no generalised version was given.
As for numerical boundary tracing using arc-length parametrisation,
Anderson~\cite{anderson-2002-thesis-boundary-tracing-pdes}
only considered Cartesian coordinates.

A generalised version of the boundary tracing ODE is much desired,
and will be most useful given the various coordinate systems
which shall be used in the remainder of this thesis.
We therefore derive in this chapter
the boundary tracing ODE for coordinate parametrisation
and also the corresponding system of ODEs for arc-length parametrisation,
with both applicable in any two-dimensional orthogonal coordinate system.

\section{Normal derivative}
\label{sec:curvilinear.derivative}

To perform boundary tracing in a specific coordinate system,
the normal derivative which appears
in the flux boundary condition~(\ref{eq:flux-boundary-condition})
must first be written in that coordinate system.

\subsection{Orthogonal curvilinear coordinates}
\label{sec:curvilinear.derivative.orthogonal}

\begin{figure}
  \centredfigurecontent[width=0.4\textwidth]{%
    orthogonal-curvilinear-coordinates%
  }{
    Infinitesimal rectangle formed by differential displacements
    in the orthogonal curvilinear coordinates~$(u, v)$.
  }
\end{figure}

Consider an orthogonal coordinate system~$(u, v)$.
By definition the $u$-contours and $v$-contours
cross everywhere at right angles,
whence if the coordinates are independently incremented
by~$\td u$ and~$\td v$,
an infinitesimal rectangle is formed
having sides~$\scalefac[u] \td u \basisvec{u}$
and~$\scalefac[v] \td v \basisvec{v}$
(Figure~\ref{fig:orthogonal-curvilinear-coordinates}),
where $\scalefac[u]$ and~$\scalefac[v]$~are the \term{scale factors}%
\footnote{
  Also called \term{\lame{} coefficients}.
  The position vector~%
    $\positionvec \ideq x \basisvec{x} + y \basisvec{y}$
  gives rise to the local basis vectors~%
    $\localvec{u} \ideq \pd\positionvec / {\pd u}$
  and~%
    $\localvec{v} \ideq \pd\positionvec / {\pd v}$,
  and hence the scale factors~$\scalefac[u] \ideq \norm{\localvec{u}}$
  and~$\scalefac[v] \ideq \norm{\localvec{v}}$.
}
and $(\basisvec{u}, \basisvec{v})$~is the \term{local orthonormal basis}%
\footnote{
  Obtained by normalising the local basis vectors,
  i.e.~$\basisvec{u} \ideq \localvec{u} / \scalefac[u]$
  and~$\basisvec{v} \ideq \localvec{v} / \scalefac[v]$.
}.
It can be shown that the normal vector~$\normalvec$ (up to sign)
and the gradient vector~$\del T$ are given by
\begin{align}
  \normalvec &\ideq
    \scalefac[v] \tder{v}{s} \basisvec{u}
      -
    \scalefac[u] \tder{u}{s} \basisvec{v},
    \label{eq:normal-vector}
    \\[\tallspace]
  \del T &\ideq
    \frac{1}{\scalefac[u]} \pder{T}{u} \basisvec{u}
      +
    \frac{1}{\scalefac[v]} \pder{T}{v} \basisvec{v},
    \label{eq:gradient}
\end{align}
where $\td s$~is the differential arc length
\begin{equation}
  \td s \ideq
  \sqrt{
    \roundbr[\bulkysize]{\scalefac[u] \td u}^2
      +
    \roundbr[\bulkysize]{\scalefac[v] \td v}^2
  }.
  \label{eq:differential-arc-length}
\end{equation}
The precise sign of the normal vector~(\ref{eq:normal-vector}) is irrelevant
for the purpose of determining the traced boundaries.
Reversing the normal vector does not change the traced boundaries;
it merely swaps the sides of the traced boundaries
which are designated as interior or exterior,
a distinction only relevant when constructing domains
\emph{after} the traced boundaries have actually been determined.

Since the scale factors~$\scalefac[u]$ and~$\scalefac[v]$ appear regularly,
it is helpful to define some abbreviations
before proceeding any further:

\subsection{Abbreviations}
\label{sec:curvilinear.derivative.abbreviations}

For the side lengths of the infinitesimal rectangle
of Figure~\ref{fig:orthogonal-curvilinear-coordinates},
we define the auxiliary differentials
\begin{align}
  \td \mu &\ideq \scalefac[u] \td u,
    \label{eq:differential-displacement-u-component} \\
  \td \nu &\ideq \scalefac[v] \td v,
    \label{eq:differential-displacement-v-component}
\end{align}
so that
\begin{equation}
  \td s \ideq \sqrt{{\td \mu}^2 + {\td \nu}^2}.
  \label{eq:differential-arc-length-abbreviated}
\end{equation}
For the components of the normal vector~(\ref{eq:normal-vector}),
we define
\begin{align}
  \alpha &\ideq \tder{\mu}{s} \ideq \scalefac[u] \tder{u}{s},
    \label{eq:tangent-u-component} \\[\tallspace]
  \beta &\ideq \tder{\nu}{s} \ideq \scalefac[v] \tder{v}{s},
    \label{eq:tangent-v-component}
\end{align}
so that
\begin{equation}
  \normalvec
    \ideq \tder{\nu}{s} \basisvec{u} - \tder{\mu}{s} \basisvec{v}
    \ideq \beta \basisvec{u} - \alpha \basisvec{v}.
  \label{eq:normal-vector-abbreviated}
\end{equation}
Finally, for the components of the gradient vector~(\ref{eq:gradient}),
we define
\begin{align}
  P &\ideq \frac{1}{\scalefac[u]} \pder{T}{u},
    \label{eq:gradient-u-component} \\[\tallspace]
  Q &\ideq \frac{1}{\scalefac[v]} \pder{T}{v},
    \label{eq:gradient-v-component}
\end{align}
so that
\begin{equation}
  \del T \ideq P \basisvec{u} + Q \basisvec{v}.
  \label{eq:gradient-abbreviated}
\end{equation}
Note that
\begin{equation}
  \alpha^2 + \beta^2 \ideq 1
  \label{eq:tangent-pythagoras}
\end{equation}
and
\begin{equation}
  P^2 + Q^2 \ideq (\del T)^2.
  \label{eq:gradient-pythagoras}
\end{equation}

\section{Boundary tracing ODE}
\label{sec:curvilinear.tracing}

Having obtained expressions
for the normal~$\normalvec$ and gradient~$\del T$
which appear in the flux boundary condition~(\ref{eq:flux-boundary-condition}),
we now derive the boundary tracing ODE for coordinate parametrisation
and the corresponding system of ODEs for arc-length parametrisation.

Following Anderson~\etal~\cite{anderson-2007-boundary-tracing-i-theory}
we define the \term{viability function}
\begin{important}{equation}
  \Phi \ideq (\del T)^2 - F^2.
  \label{eq:viability-function}
\end{important}
This is not only algebraically useful,
but also physically meaningful;
the viable domain is the region~$\Phi \ge 0$,
the non-viable domain, $\Phi < 0$,
and the terminal curve, $\Phi = 0$.

\subsection{Coordinate parametrisation}
\label{sec:curvilinear.tracing.coordinate}

Suppose the traced boundaries are to be parametrised
in the form~$v = v (u)$.
Using~(\ref{eq:differential-arc-length-abbreviated}),
(\ref{eq:normal-vector-abbreviated}),
and~(\ref{eq:gradient-abbreviated}),
the boundary condition~(\ref{eq:flux-boundary-condition}) becomes
\[
  \frac{
    \td \nu \basisvec{u} - \td \mu \basisvec{v}
  }{
    \sqrt{{\td \mu}^2 + {\td \nu}^2}
  }
    \dotp
  \roundbr[\bulkysize]{P \basisvec{u} + Q \basisvec{v}}
    =
  F,
\]
which yields the quadratic equation
\begin{equation}
  \roundbr*{P^2 - F^2} \, {\td \nu}^2
  - 2 P Q \td \nu \td \mu
  + \roundbr*{Q^2 - F^2} \, {\td \mu}^2
    =
  0.
  \label{eq:tracing-coordinate-parametrisation-quadratic}
\end{equation}
Solving for~$\td \nu / {\td \mu}$, we obtain the boundary tracing ODE
\begin{equation}
  \tder{\nu}{\mu} = \frac{P Q \pm F \sqrt{\Phi}}{P^2 - F^2},
  \label{eq:tracing-ode-coordinate-parametrisation-nu}
\end{equation}
or
\begin{important}{equation}
  \tder{v}{u} =
    \frac{\scalefac[u]}{\scalefac[v]}
      \cdot
    \frac{P Q \pm F \sqrt{\Phi}}{P^2 - F^2}.
  \label{eq:tracing-ode-coordinate-parametrisation-v}
\end{important}
Alternatively, for the parametrisation~$u = u (v)$,
we instead solve for~$\td \mu / {\td \nu}$, obtaining
\begin{important}{equation}
  \tder{u}{v} =
    \frac{\scalefac[v]}{\scalefac[u]}
      \cdot
    \frac{P Q \mp F \sqrt{\Phi}}{Q^2 - F^2}.
  \label{eq:tracing-ode-coordinate-parametrisation-u}
\end{important}
In both cases, the two possible choices of sign
correspond to the two branches of traced boundaries
which exist in the viable domain.
The earlier claim regarding the irrelevance
of the sign of the normal vector
(for the purpose of determining the traced boundaries)
is confirmed;
reversing the normal~$\normalvec$
in the flux boundary condition~(\ref{eq:flux-boundary-condition})
is equivalent to replacing~$F$ by~$-F$,
which merely swaps the two branches
in~(\ref{eq:tracing-ode-coordinate-parametrisation-v})
and~(\ref{eq:tracing-ode-coordinate-parametrisation-u}).

The occurrence of the term~$\sqrt{\Phi}$
corresponds to the absence of traced boundaries
in the non-viable domain~$\Phi < 0$.

Whichever of the symbols~$\pm$ and~$\mp$ occurs,
the \term{upper} branch shall refer to
the traced boundaries for the upper sign in that symbol,
and the \term{lower} branch to those for the lower sign
(e.g.~in~(\ref{eq:tracing-ode-coordinate-parametrisation-u}),
the upper branch corresponds to choosing the minus sign,
while the lower branch corresponds to choosing the plus sign).

\subsection{Arc-length parametrisation}
\label{sec:curvilinear.tracing.arc-length}

In numerical boundary tracing,
the coordinate parametrisations~$v = v (u)$ and~$u = u (v)$
will be problematic
if~$\td v / {\td u}$ or~$\td u / {\td v}$ ever become infinite,
corresponding to traced boundaries
which are parallel to~$\basisvec{v}$ or~$\basisvec{u}$.

To avoid such singularities in numerical work, we should instead use
the arc-length parametrisation~$u = u (s)$, $v = v(s)$
to put the two coordinates~$u$ and~$v$ on an equal footing.
Using~(\ref{eq:normal-vector-abbreviated})
and~(\ref{eq:gradient-abbreviated}),
the boundary condition~(\ref{eq:flux-boundary-condition}) becomes
\[
  \roundbr[\bulkysize]{\beta \basisvec{u} - \alpha \basisvec{v}}
    \dotp
  \roundbr[\bulkysize]{P \basisvec{u} + Q \basisvec{v}}
    =
  F,
\]
which, together with the unit-speed condition~(\ref{eq:tangent-pythagoras}),
forms the system%
\footnote{
  This system is also given
  in Anderson's thesis~\cite{anderson-2002-thesis-boundary-tracing-pdes}
  (equations (A.1) and~(A.2)),
  but only in Cartesian coordinates
  and with~$\pm F$ in place of~$F$.
  Moreover the system is passed directly to a numerical integrator
  without first solving for~$\alpha$ and~$\beta$,
  so that at every step of the integration,
  a numerical comparison with the previous root
  is required to select the correct root among the four possible.
  A better approach is to separate the two branches analytically
  before performing any numerical procedures,
  as we have done here
  in~(\ref{eq:tracing-ode-arc-length-parametrisation-mu})
  and~(\ref{eq:tracing-ode-arc-length-parametrisation-nu}).
}
\begin{align}
  P \beta - Q \alpha &= F,
    \label{eq:tracing-arc-length-parametrisation-flux-boundary-condition} \\
  \alpha^2 + \beta^2 &= 1.
    \label{eq:tracing-arc-length-parametrisation-unit-speed}
\end{align}
Solving~(\ref{eq:tracing-arc-length-parametrisation-flux-boundary-condition})
and~(\ref{eq:tracing-arc-length-parametrisation-unit-speed})
for~$\alpha$ and~$\beta$, we obtain
the boundary tracing system of ODEs under arc-length parametrisation,
\begin{align}
  \tder{\mu}{s} &\ideq \alpha = \frac{-Q F \pm P \sqrt{\Phi}}{(\del T)^2},
    \label{eq:tracing-ode-arc-length-parametrisation-mu} \\[\tallspace]
  \tder{\nu}{s} &\ideq \beta = \frac{\+P F \pm Q \sqrt{\Phi}}{(\del T)^2},
    \label{eq:tracing-ode-arc-length-parametrisation-nu}
\end{align}
or
\begin{important}{align}
  \tder{u}{s} &= \frac{-Q F \pm P \sqrt{\Phi}}{\scalefac[u] (\del T)^2},
    \label{eq:tracing-ode-arc-length-parametrisation-u} \\[\tallspace]
  \tder{v}{s} &= \frac{\+P F \pm Q \sqrt{\Phi}}{\scalefac[v] (\del T)^2}.
    \label{eq:tracing-ode-arc-length-parametrisation-v}
\end{important}
As was the case for coordinate parametrisation
(Section~\ref{sec:curvilinear.tracing.coordinate}),
we note the two possible choices of sign
(which correspond to the two branches of traced boundaries)
and the occurrences of the term~$\sqrt{\Phi}$
(which correspond to the absence of traced boundaries
in the non-viable domain~$\Phi < 0$).

Again we confirm the earlier claim
regarding the irrelevance of the sign of the normal vector;
reversing~$\normalvec$
in the flux boundary condition~(\ref{eq:flux-boundary-condition})
is equivalent to replacing~$F$ by~$-F$,
which, in the system~(\ref{eq:tracing-ode-arc-length-parametrisation-u})
and~(\ref{eq:tracing-ode-arc-length-parametrisation-v}),
is equivalent to swapping the two branches
and replacing~$s$ by~$-s$ (i.e.~travelling backwards).

\section{Summary}
\label{sec:curvilinear.summary}

Although the theory of boundary tracing
has not been restricted to Cartesian coordinates in the literature~\cite{
  anderson-2002-thesis-boundary-tracing-pdes,
  anderson-2007-boundary-tracing-i-theory,
  anderson-2007-boundary-tracing-ii-applications
},
the boundary tracing ODE has only been written down
in specific non-Cartesian coordinate systems.
A generalised version is desirable,
and in anticipation of the coordinate systems
which shall be used in the chapters to follow,
we have derived in this chapter
the boundary tracing ODE for coordinate parametrisation
and the corresponding system of ODEs for arc-length parametrisation.
Both are applicable in any two-dimensional orthogonal coordinate system,
with the former appropriate for analytical work
and the latter useful in numerical boundary tracing.
